---
title: MySQL笔记
date: 2024-09-07 22:23:02 +0800
categories: [blog, mysql]
tags: [mysql, note]     # TAG names should always be lowercase
---
## 1.基础篇

### DDL

####  数据库操作

``````SQL
SHOW DATABASE;
CREATE DATABASE $;
USE $;
SELECT DATABASE();
DROP DATABASE $;
``````

#### 表操作

``````SQL
SHOW TABLES;
CREATE TABLE [IF NOT EXISTS]  $($ $,$ $);
DESC $;
SHOW CREATE TABLE 4;
ALTER TABLE $ ADD/MODIFY/CHANGE/DROP/RENAME TO $;
DROP TABLE $;
``````

### DML

Data Manipulation Language(数据操作语言)，对表中数据进行增删改操作

#### 添加数据INSERT

``````sql
INSERT INTO $($,$,...) VALUES($,$,..);

INSERT INTO $ VALUES($,$,...);

INSERT INTO $($,$,...) VALUES($,$,...),($,$,...),($,$,...);
INSERT INTO $ VALUES($,$,...),($,$,...),($,$,...);
``````

#### 修改数据

``````sql
UPDATE $ SET $=$,$=$,... [WHERE $];
``````

#### 删除数据

``````sql
DELETE FROM $ [WHERE $];
``````

### DQL

Data Query Language

### 查询

``````
SELECT
	字段列表
FROM
	表名列表
WHERE
	条件列表
GROUP BY
	分组字段列表
HAVING
	分组后条件列表
ORDER BY
	排序字段列表
LIMIT
	分页参数
``````

#### 基本查询

查询多个字段

``````
SELECT $,$,... FROM $;
SELECT * FROM $;
``````

设置别名

``````
SELECT $ [AS $],$ [AS $]... FROM $;
``````

去除重复记录

``````
SELECT DISTINCT $ FROM $;
``````

条件查询

``````
SELECT $ FROM $ WHERE $;
!= <> BETWEEN...AND... LIKE IN(...) IS NULL AND OR NOT
``````

聚合函数

``````
SELECT Function($) FROM $; 
count max min avg sum
``````

分组查询

``````
SELECT $ FROM $ [WHERE $] GROUP BY $ [HAVING $];
``````

排序查询

``````
SELECT $ FROM $ ORDER BY $ $,$ $;
ASC 默认升序 DESC 降序
``````

分页查询

``````
SELECT $ FROM $ LIMIT 起始索引,查询记录数;
起始索引=（查询页码-1）*每页记录数;
``````

### DCL

Data Control Language(数据控制语言)

查询用户

``````
USE mysql;
SELECT * FROM user;
``````

创建用户

``````
CREATE USER '用户名@主机名' IDENTIFIED BY '密码';
``````

修改用户密码

``````
ALTER USER ' 用户名@主机名' IDENTIFIED WITH '旧密码' BY '新密码';
``````

删除用户

``````
DROP USER '用户名@主机名';
``````

## 函数

### 字符串函数

```````
CONTACT(S1,S2,...);
LOWER(STR);
UPPER(STR);
LPAD(STR,N,PAD);
RPAD(STR,N,PAD);
TRIM(STR);
SUBSTRING(STR,START,LEN);
```````

### 数值函数

``````
CEIL(x);
FLOOR(x);
MOD(x,y);
RAND();
ROUND(x,y);
``````

### 日期函数

```````
CURDATE();
CURTIME();
NOW();
YEAR(DATE);
MONTH(DATE);
DAY(DATE);
DATE_ADD(DATE,INTERVAL $ DAY/MONTH/YEAR);
DATEDIFF(DATE1,DATE2);
```````

### 流程函数

````````
IF(BOOL,T,F);
IFULL(VALUE1,VALUE2);
CASE WHEN [VAL1] THEN [RES1] ...ELSE [DEFAULT] END;
CASE [EXPR] WHEN [VAL1] THEN [RES1]...ELSE[DEFAULT] END;
````````

## 约束

``````
NOT NULL;非空约束
UNIQUE;唯一约束
PRIMARY KEY;主键约束
DEFAULT;默认约束
CHECK;检查约束
FOREIGN KEY;外键约束
``````

``````
CREATE TABLE $(
	$ $,
	[CONSTRAINT] [外键名称] FOREIGN KEY(外键字段名) REFERENCES 主表(主表列名)
);
ALTER TABLE $ ADD CONSTRAINT $ FOREIGN KEY(外键字段名) REFERENCES 主表(主表列名) ON UPDATE CASADE ON DELETE CASCADE;
``````

### 多表查询

``````sql

``````

连接查询

​	内连接：查询A、B交集部分

``````
SELECT 字段列表 FROM 表1,表2 WHERE 条件;
SELECT 字段列表 FROM 表1 [INNER] JOIN 表2 ON 连接条件;
``````

​	外连接：

​		左外连接：查询左表所有数据及交集部分

​		右外连接：查询右表所有数据及交集部分
``````
SELECT 字段列表 FROM 表1 LEFT [OUTER] JOIN 表2 ON 条件;
SELECT 字段列表 FROM 表1 RIGHT [OUTER] JOIN 表2 ON 条件;
``````
​	自连接：当前表与自身的连接查询

```````
SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件;
```````

​	子查询（嵌套查询）

标量子查询

常用操作符:=  <>  >  >=  <  <=

``````
SELECT $ FROM $ WHERE $=(SELECT $ FROM $ WHERE $=$);
``````

列子查询

常用操作符

IN NOT IN SOME ALL ANY

表子查询 常用操作符IN

联合查询，查询字段要相同

union all直接合并，union会对合并后数据去重

``````
SELECT 字段列表 FROM 表A
UNION [ALL]
SELECT 字段列表 FROM 表B;
``````

### 事务

``````
SELECT @@auotcommit;查看事务提交方式
SET @@autocommit=0;设置事务提交方式
COMMIT;
ROLLBACK;
``````

### 索引

```````
创建索引
create [unique] index 索引名 on 表名（字段名，.）：
查看索引
show index from表名；
删除索引
drop index 索引名 on 表名；
```````

## 2.进阶篇

### 存储引擎

#### InnoDB

MySQL5.5后默认引擎

特点：DML操作遵循ACID模型，支持事务；

​	行级锁，提高并发访问性能；

​	支持外键约束

每个表对应一个ibd表空间文件

是Mysq的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。

#### MyISAM

早期默认引擎，不支持事务外键，支持表锁不支持行锁

应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。如日志，访问记录，常用MogoDB替代

#### Memory

作为临时表或缓存，内存存放，hash索引

将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORYE的缺陷就是对表的大小有限制，太大的表
无法缓存在内存中，而且无法保障数据的安全性，常用redis

![engine](/assets/img/2024-9-7-MySQL/engine.png)
